---
title: Signpostë¥¼ ì´ìš©í•´ì„œ ì•± Performance ê°œì„ í•˜ê¸° 
date: 2018-09-21 10:14:54 +0900
categories: swift
tags:
  - signsopt
  - ios
  - swift
---
Xcode Instrumentsì—ì„œ ì œê³µí•˜ê³  ìˆëŠ” Signpost ì‚¬ìš©ë²•ì„ ì•Œì•„ë³´ì.

## ê°œë°œ ê²½í—˜

ê°œë°œ í”„ë¡œì íŠ¸ ì¼ì •ì˜ ë§‰ë°”ì§€ì— ì´ë¥´ê²Œë˜ë©´ ì–´ë””ë“  ë²„ê·¸ ìˆ˜ì •ì— ì˜¨ ì •ì‹ ì„ ì§‘ì¤‘í•˜ê²Œ ëœë‹¤.
í•˜ì§€ë§Œ ìš”ì¦˜ ì‹œëŒ€ì˜ í”„ë¡œê·¸ë¨ë“¤ ì™„ì„±ë„ë¿ì´ ì•„ë‹ˆë¼ ì‚¬ìš©ìì˜ ê¸°ëŒ€ Performance ìˆ˜ì¤€ì´ ë†’ê¸° ë•Œë¬¸ì— ë‹¹ì—°íˆ í”„ë¡œê·¸ë¨ ë™ì‘ ì†ë„ê¹Œì§€ ì²´í¬í•´ì•¼í•œë‹¤. 

ì‚¬ì‹¤ ë‚˜ëŠ” ì˜¤ëœ iOS ê°œë°œì„ í•˜ë©´ì„œ Performance ì´ìŠˆëŠ” í•­ìƒ ë°œìƒì„ í–ˆë‹¤. 
ê°œë°œì„í•  ë•Œ ë‚´ê°€ ì§‘ì¤‘í•œ ë¶€ë¶„ì´ ë‹¤ë¥´ê¸°ë„ í•˜ì§€ë§Œ, ê°œë°œìê°€ ê³ ë ¤í•˜ê³  ìƒê°í•´ì•¼í•˜ëŠ” ê²ƒë“¤ì´ ë„ˆë¬´ ë§ë‹¤.

ì™¸ë¶€ì ìœ¼ë¡œëŠ” ì¼ì •ê³¼ ìš”ê±´ì— ëŒ€í•œ ê¸°ìˆ  í˜‘ì˜
ë‚´ë¶€ì ìœ¼ë¡œëŠ” ê°œë°œ ì•„í‚¤í…ì²˜ë§ì´ë‚˜ ì½”ë“œ ìì²´ê°€ ì˜³ë°”ë¥¸ ì±…ì„ì„ ê°€ì§€ê³  ìˆëŠ”ì§€ ìƒê°í•˜ê³ , ê¸°íš ìš”ê±´ì— ì‹¤ì œ êµ¬í˜„í•˜ë©´ì„œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ë˜ ë‹¤ë¥¸ ì½”ë“œë‚˜ ë²„ê·¸ìƒí™©ì— ëŒ€í•´ì„œ ë¯¸ë¦¬ ìƒê°í•´ì•¼ í•œë‹¤.

ê·¸ë˜ì„œ Performance ë¶€ë¶„ì´ ê°œë°œìì˜ ë¨¸ë¦¬ì†ì—ì„œ ì†Œì™¸ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì´ê²ƒê¹Œì§€ ì˜ ì±™ê²¨ì•¼ ë©‹ì§„ ê°œë°œìë  ìˆ˜ ìˆë‹¤.

ì•„ë¬´íŠ¼. Performanceë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´ì„  í¬ê°œ ë‘ê°€ì§€ ì‘ì—…ì´ ì„ í–‰ë˜ì•¼ í•œë‹¤. 

1. Performanceë¥¼ ê°œì„ í•œ í•  ê³³ (ì£¼ë¡œ, ë©”ì¸í™”ë©´ì´ë‚˜, ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•œë‹¤ë˜ê°€ ë§¤ë²ˆ ê·¸ ë¶€ë¶„ì€ ì •í•´ì ¸ ìˆë‹¤.)
2. ì‹¤ì œ Performanceê°€ ëŠë¦° ê³³ ì°¾ê¸°
3. ì½”ë“œ ìˆ˜ì • í›„ Performance ê°œì„  í™•ì¸

ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” 2ë²ˆì— ëŒ€í•´ì„œ ì´ì•¼ê¸°ë¥¼ í•´ë³´ë ¤ê³  í•œë‹¤.


## ê¸°ì¡´ì˜ Performance ê°œì„  ë°©ì‹

ì²«ë²ˆì§¸ëŠ” ë©”ëª¨ë¦¬ Leakì˜ í•´ê²°ì´ë‹¤. ì¼ë‹¨ ë©”ëª¨ë¦¬ë¦­ì´ ìˆìœ¼ë©´ í¼í¬ë¨¼ìŠ¤ ê°œì„  ë‹¨ê³„ê°€ ì•„ë‹ˆë‹¤. ìš°ì„  ë©”ëª¨ë¦¬ë¦­ë¶€í„° ëª¨ë‘ í•´ê²°í•œë‹¤.
ê·¸ëŸ° ë‹¤ìŒ ì‹¤ì œ ì†ë„ ì²´í¬ë¥¼ í•˜ëŠ”ë°, 
ë‚˜ëŠ” TimeChecker í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì—ˆë‹¤.

```swift
@objc class TimeChecker: NSObject {
    static var startTime:Date?
    
    @objc static func start(){
        if startTime == nil{
            startTime = Date()
        }
    }
    
    @objc static func end(){
        if let startTime = startTime{
            let interval = Date().timeIntervalSince(startTime)
            print("TimeChecker \(interval)")
            self.startTime = nil
        }
    }
}
```

ê°„ë‹¨í•œê²Œ ì‹œì‘ ì²´í¬ ì‹œì‘ ```TimeChecker.start()```ë¥¼ í˜¸ì¶œí•˜ê³ , Taskê°€ ì¢…ë£Œë˜ëŠ” ë¶€ë¶„ì—ì„œ ```TimeChecker.end()```ë¥¼ í˜¸ì¶œí•˜ë©´ ì‹œì‘ê³¼ ëì‚¬ì´ì˜ interval ì‹œê°„ì´ í‘œì‹œëœë‹¤.

ì´ ë°©ë²•ì˜ ë¬¸ì œëŠ” ì—¬ëŸ¬ê°œì˜ taskë¥¼ ë™ì‹œì— Threadì—ì„œ ì²˜ë¦¬í•  ê²½ìš° ì²´í¬ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤ëŠ” ë‹¨ì ì´ ìˆì–´ í•­ìƒ ì–¸ì  ê°„ ê°œì„ ì„ í•´ì•¼ ê² ë‹¤ëŠ” ìƒê°ì„ í•˜ê³  ìˆì—ˆë‹¤. 

ê·¸ëŸ°ë° ë§ˆì¹¨ ì´ë²ˆ WWDC2018ì—ì„œ *Measuring Performance Using Logging* ì„¹ì…˜ì´ ì†Œê°œë˜ì—ˆë‹¤.

## Signpost

Appleì€ 2ë…„ì „ì— OSLogë¥¼ ì†Œê°œí–ˆëŠ”ë°, ì´ê²ƒì€ íš¨ìœ¨ì„±ê³¼ Privacyë¥¼ ëª©í‘œë¡œ ë§Œë“¤ì—ˆë‹¤ê³  í•œë‹¤. ê·¸ëŸ°ë° ì´ë²ˆ WWCD2018ì—ì„œ ì†Œê°œí•˜ê³  ìˆëŠ” Loggingì€ OSLogë¥¼ ì´ìš©í•˜ì—¬ Instrumentsì—ì„œ ì‹œê°ì ìœ¼ë¡œ ë³´ëŠ” ë°©ë²•ì„ ì†Œê°œí–ˆë‹¤.
ê·¸ë¦¬ê³ , SignpostëŠ” ê° Task ë³„ ì‹œê°„ ì²´í¬ë„ ìˆ˜ ìˆë‹¤ê³  í•œë‹¤.

![1](/assets/images/2018-09-21-Signpost.assets/1.png)

![2](/assets/images/2018-09-21-Signpost.assets/2.png)


## Signpost ì½”ë“œ ì‚½ì…

ì¼ë‹¨ ë‚˜ëŠ” ê¸°ì¡´ì— ```class TimeChecker```ì˜ í™•ì¥ì„ ì‹œë„í–ˆë‹¤.
ê·¸ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤

```swift
@objc class TimeChecker: NSObject {
    //MARK: - Signpost
    static let osLog = OSLog(subsystem: "com.measure.signpost", category: "Create Object")
    @objc static func startOSLog(){
        if #available(iOS 12.0, *) {
            os_signpost(.begin, log: TimeChecker.osLog, name: "load")
        } else {
            // Fallback on earlier versions
        }
    }
    
    @objc static func endOSLog(){
        if #available(iOS 12.0, *) {
            os_signpost(.end, log: TimeChecker.osLog, name: "load")
        } else {
            // Fallback on earlier versions
        }
    }
}
```

ê°„ëµí•˜ê²Œ ì„¤ëª…í•˜ë©´,  ```OSLog``` ì˜ ```init(subsystem: String, category: String)```ë©”ì†Œë“œë¥¼ í†µí•´  Log Hendle ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , ```os_signpost``` ë©”ì†Œë“œì˜ íŒŒë¼ë©”í„°ì— ```.begin```ê³¼ ```.end```ë¥¼ ë„£ì–´ì£¼ë©´ ëë‚œë‹¤.
ìƒê°ë³´ë‹¤ ì§„ì…ì¥ë²½ì´ ë†’ì§€ëŠ” ì•Šë‹¤. 

ë‹¤ë§Œ ì£¼ì˜í•´ì•¼ í• ê²ƒì€  íŒŒë¼ë©”í„°ì¤‘ ```name```ì´ ```StaticString``` ì´ê¸° ë•Œë¬¸ì— ë³€ìˆ˜ë¥¼ ë„£ì„ ìˆ˜ê°€ ì—†ì–´ ```function```ìœ¼ë¡œì¨ ê¸°ëŠ¥ì„ ë§Œë“¤ê¸°ëŠ” ì–´ë µë‹¤.
```swift
public func os_signpost(_ type: OSSignpostType, dso: UnsafeRawPointer = #dsohandle, log: OSLog, name: StaticString, signpostID: OSSignpostID = default)
```


ì´ì œ Performance ì²´í¬ë¥¼ í•˜ê³  ì‹¶ì€ ê³³ì— ìœ„ ì½”ë“œë¥¼ ì‚½ì…í•˜ì—¬ ì‹¤ì œ ì–´ë–»ê²Œ ì²´í‚¹ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•´ ë³´ì.

## Instruments ì‹¤í–‰

ì´ì œ Profileì„ ì‹¤í–‰í•´ë³´ì.

![profile](/assets/images/2018-09-21-Signpost.assets/profile.png)

Instumentsê°€ ì¼œì§€ë©´ ì¢Œì¸¡ìƒë‹¨ì— ìˆëŠ” Blankë¥¼ ì„ íƒí•˜ê³ ,

![select](/assets/images/2018-09-21-Signpost.assets/select.png)

í”ŒëŸ¬ìŠ¤ ë²„íŠ¼ì„ ëˆ„ë¥¸ í›„ ```signpost``ë¥¼ ê²€ìƒ‰í•˜ê³  ë“œë ˆê·¸í•˜ì—¬ ì¶”ê°€í•œë‹¤.

![find_signpost](/assets/images/2018-09-21-Signpost.assets/find_signpost.png)

ë‹¤ìŒ, Instrumentsì˜ ğŸ”´ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹¤í–‰í•œ í›„, ì•±ì„ ë™ì‘í•˜ë©´ íƒ€ì„ì²´í¬ê°€ ë˜ëŠ” ê²ƒì„ ë³¼ìˆ˜ ìˆë‹¤.

![runtime](/assets/images/2018-09-21-Signpost.assets/runtime.png)

ì´ë¯¸ì§€ì— ë³´ì´ëŠ” ê²ƒê³¼ ê°™ì´ ì²´í¬ ì‹œê°„ë„ ë³¼ ìˆ˜ ìˆê³ , ì‹œê°ì ìœ¼ë¡œ Taskê°€ ì–¸ì œ ë™ì‘ë˜ì—ˆëŠ”ì§€ë„ ì•Œ ìˆ˜ ìˆë‹¤.



## ê²°ë¡ 
ì´ í¬ìŠ¤íŠ¸ëŠ” ì†ë„ ì´ìŠˆì— ëŒ€í•œ í•´ê²°ì±… ìì²´ë¥¼ ê°€ì§€ê³  ìˆì§€ëŠ” ì•Šë‹¤. í•˜ì§€ë§Œ ë³µì¡í•˜ê²Œ ëŒì•„ê°€ëŠ” ìš°ë¦¬ì˜ ì•±ì•ˆì—ì„œ ì–´ëŠë¶€ë¶„ì— ì‹œê°„ì´ ë§ì´ ì†Œìš”ë˜ê³  ìˆëŠ”ì§€ íŒŒì•…í•˜ê¸°ì—ëŠ” ë”í•  ë‚˜ìœ„ ì—†ì´ ì¢‹ì€ ë°©ë²•ì´ë‹¤. ì•ìœ¼ë¡œ ì—¬ëŸ¬ê³³ì—ì„œ signspostë¥¼ ì´ìš©í•˜ì—¬ Performance ì²´í¬ë¥¼ í•´ë³´ì•¼ê² ë‹¤. 





---

### References
- [Minimal Mistakes Quick-Start Guide](https://mmistakes.github.io/minimal-mistakes/docs/quick-start-guide/)
- [Getting started with signposts](https://www.swiftbysundell.com/daily-wwdc/getting-started-with-signposts)
- [Measuring Performance Using Logging(Apple)](https://developer.apple.com/videos/play/wwdc2018/405/)
- [Measuring Performance Using Logging(ASCIIwwdc)](https://asciiwwdc.com/2018/sessions/405)

